# 通信

在本节中，我们将详细描述client和server之间的通信过程。从建立连接、发送请求到接收响应。示例将假设pitaya以集群模式运行，不同的server连接着不同的client。

## 建立连接

当客户端连接并发出请求时会发生什么:

* 首先和server模块中的acceptor建立一个连接（connection）
* 将连接(connection)传递给handler service
* handler service为connection创建一个新的agent
* Handler service读取connection中的message
* 通过配置好的decoder，将message进行解码
* 处理message中的解码包
* 第一个包必须是一个**握手请求（即handshake request）**，服务器返回一个**握手响应（即handshake response）**，该响应中带有**解析器（serializer）**，**路由字典（route dictionary）**及**心跳超时（heartbeat timeout）**相关信息
* 客户端此时需要对此作出**握手应答（即handshake ack）**,此时，连接就建立好了

